{{- if .Values.externalSecrets.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: green-agent-mtls
  namespace: {{ .Release.Namespace }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
  secretStoreRef:
    kind: ClusterSecretStore
    name: {{ .Values.externalSecrets.secretStore }}
  target:
    name: green-agent-mtls
  data:
    - secretKey: tls.crt
      remoteRef: { key: k8s-green/agent/mtls, property: cert }
    - secretKey: tls.key
      remoteRef: { key: k8s-green/agent/mtls, property: key }
    - secretKey: ca.crt
      remoteRef: { key: k8s-green/agent/mtls, property: ca }
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: green-agent-secrets
  namespace: {{ .Release.Namespace }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: {{ .Values.externalSecrets.secretStore }}
  target:
    name: green-agent-secrets
  data:
    - secretKey: signing-key
      remoteRef: { key: k8s-green/agent/config, property: signing-key }
    - secretKey: nats-url
      remoteRef: { key: k8s-green/agent/config, property: nats-url }
{{- end }}
